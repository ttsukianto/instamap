library(ggplot2)
us_map <- function(path, state_label, var_label) {
states <- map_data("state")
data <- read.csv(path)
data <- subset(data, select=c(state_label, var_label))
data$var_label <- as.numeric(as.character(data$var_label))
names(data) <- c("region",var_label)
data$region <- tolower(data$region)
mapped_data <- merge(states, data, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_data, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_data$var_label))
return plot;
}
us_map <- function(path, state_label, var_label) {
states <- map_data("state")
data <- read.csv(path)
data <- subset(data, select=c(state_label, var_label))
data$var_label <- as.numeric(as.character(data$var_label))
names(data) <- c("region",var_label)
data$region <- tolower(data$region)
mapped_data <- merge(states, data, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_data, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_data$var_label))
return plot
}
us_map <- function(path, state_label, var_label) {
states <- map_data("state")
data <- read.csv(path)
data <- subset(data, select=c(state_label, var_label))
data$var_label <- as.numeric(as.character(data$var_label))
names(data) <- c("region",var_label)
data$region <- tolower(data$region)
mapped_data <- merge(states, data, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_data, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_data$var_label))
}
View(us_map)
View(us_map)
state_raw <- read.delim("state.txt")
write.csv(x=state_raw, file="state.csv")
states <- map_data("state")
library(mapproj)
install.packages("maps")
library(maps)
states <- map_data("state")
opioid_deaths <- read.csv("state.csv")
opioid_deaths <- read.csv("state.csv")
opioid_deaths <- read.csv("state.csv")
View(opioid_deaths)
opioid_deaths <- opioid_deaths[opioid_deaths$Notes=="Total",]
opioid_deaths <-subset(opioid_deaths, select=c(State, Crude.Rate))
opioid_deaths  <- opioid_deaths[!(opioid_deaths$Crude.Rate=="Unreliable"),]
View(opioid_deaths)
write.csv(opioid_deaths, "test.csv")
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(path, state_label, var_label) {
states <- map_df("state")
df <- read.csv(path)
df <- subset(df, select=c(state_label, var_label))
df$var_label <- as.numeric(as.character(df$var_label))
names(df) <- c("region",var_label)
df$region <- tolower(df$region)
mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_df, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(path)
df <- subset(df, select=c(state_label, var_label))
df$var_label <- as.numeric(as.character(df$var_label))
names(df) <- c("region",var_label)
df$region <- tolower(df$region)
mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_df, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", State, Crude.Rate)
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(path)
df <- subset(df, select=c(state_label, var_label))
df$var_label <- as.numeric(as.character(df$var_label))
names(df) <- c("region",var_label)
df$region <- tolower(df$region)
mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_df, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
#df <- read.csv(df_path)
#df <- subset(df, select=c(state_label, var_label))
#df$var_label <- as.numeric(as.character(df$var_label))
#names(df) <- c("region",var_label)
#df$region <- tolower(df$region)
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
#df <- subset(df, select=c(state_label, var_label))
#df$var_label <- as.numeric(as.character(df$var_label))
#names(df) <- c("region",var_label)
#df$region <- tolower(df$region)
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
#df$var_label <- as.numeric(as.character(df$var_label))
#names(df) <- c("region",var_label)
#df$region <- tolower(df$region)
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df$var_label <- as.numeric(as.character(df$var_label))
#names(df) <- c("region",var_label)
#df$region <- tolower(df$region)
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
#names(df) <- c("region",var_label)
#df$region <- tolower(df$region)
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
names(df) <- c("region",var_label)
#df$region <- tolower(df$region)
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
names(df) <- c("region",var_label)
df[,region] <- tolower(df[,region])
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
names(df) <- c("region",var_label)
df[,region] <- tolower(df[,region])
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
names(df) <- c("region",var_label)
df[,"region"] <- tolower(df[,"region"])
#mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
names(df) <- c("region",var_label)
df[,"region"] <- tolower(df[,"region"])
mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
#plot <- ggplot(mapped_df, aes(long, lat)) +
#geom_polygon(color="white",aes(group=group, fill=mapped_df$var_label))
#return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
us_map <- function(df_path, state_label, var_label) {
states <- map_data("state")
df <- read.csv(df_path)
df <- subset(df, select=c(state_label, var_label))
df[,var_label] <- as.numeric(as.character(df[,var_label]))
names(df) <- c("region",var_label)
df[,"region"] <- tolower(df[,"region"])
mapped_df <- merge(states, df, sort = TRUE, by = "region", all=TRUE)
plot <- ggplot(mapped_df, aes(long, lat)) +
geom_polygon(color="white",aes(group=group, fill=mapped_df[,var_label]))
return(plot)
}
us_map("test.csv", "State", "Crude.Rate")
state_map
state_map <- function(df_path, state, county_label, var_label) {
state <- tolower(state)
states <- map_data("state")
counties <- map_data("county")
state_df <- subset(states, region == state)
state_county_df <- subset(counties, region == state)
df <- read.csv(df_path)
df <- subset(df, select=c(county_label, var_label))
names(df) <- c("subregion", var_label)
df[,"subregion"] <- tolower(df[,"subregion"])
df[,var_label] <- as.numeric(as.character(df[,var_label]))
mapped_df <- inner_join(state_county_df, df, by="subregion")
plot <- ggplot(data = mapped_df, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(data=mapped_df, aes(fill=mapped_df[,var_label]), color="white") +
return(plot)
}
wv_counties <- read.delim("~/PHDC 2018 Visualizations/wv_counties.txt")
View(wv_counties)
wv_counties
#keep totals only
wv_counties <- wv_counties[wv_counties$Notes=="Total",]
#keep county and rate columns only
wv_counties <-subset(wv_counties, select=c(County, Crude.Rate))
#make all county names lowercase
wv_counties$subregion <- tolower(wv_counties$subregion)
#make all county names lowercase
wv_counties$County <- tolower(wv_counties$County)
#drop "county, wv" after county names
wv_counties$County <- gsub(" county, wv", "", wv_counties$County)
#drop state totals
wv_counties <-head(wv_counties, -3)
write.csv(wv_counties, "test2.csv")
state_map <- function(df_path, state, county_label, var_label) {
state <- tolower(state)
states <- map_data("state")
counties <- map_data("county")
state_df <- subset(states, region == state)
state_county_df <- subset(counties, region == state)
df <- read.csv(df_path)
df <- subset(df, select=c(county_label, var_label))
names(df) <- c("subregion", var_label)
df[,"subregion"] <- tolower(df[,"subregion"])
df[,var_label] <- as.numeric(as.character(df[,var_label]))
mapped_df <- inner_join(state_county_df, df, by="subregion")
plot <- ggplot(data = mapped_df, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(data=mapped_df, aes(fill=mapped_df[,var_label]), color="white") +
return(plot)
}
state_map("test2.csv", "West Virginia", "County", "Crude.Rate")
library(dplyr)
state_map <- function(df_path, state, county_label, var_label) {
state <- tolower(state)
states <- map_data("state")
counties <- map_data("county")
state_df <- subset(states, region == state)
state_county_df <- subset(counties, region == state)
df <- read.csv(df_path)
df <- subset(df, select=c(county_label, var_label))
names(df) <- c("subregion", var_label)
df[,"subregion"] <- tolower(df[,"subregion"])
df[,var_label] <- as.numeric(as.character(df[,var_label]))
mapped_df <- inner_join(state_county_df, df, by="subregion")
plot <- ggplot(data = mapped_df, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(data=mapped_df, aes(fill=mapped_df[,var_label]), color="white") +
return(plot)
}
state_map("test2.csv", "West Virginia", "County", "Crude.Rate")
state_map <- function(df_path, state, county_label, var_label) {
state <- tolower(state)
states <- map_data("state")
counties <- map_data("county")
state_df <- subset(states, region == state)
state_county_df <- subset(counties, region == state)
df <- read.csv(df_path)
df <- subset(df, select=c(county_label, var_label))
names(df) <- c("subregion", var_label)
df[,"subregion"] <- tolower(df[,"subregion"])
df[,var_label] <- as.numeric(as.character(df[,var_label]))
mapped_df <- inner_join(state_county_df, df, by="subregion")
plot <- ggplot(data = mapped_df, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(data=mapped_df, aes(fill=mapped_df[,var_label]), color="white")
return(plot)
}
state_map("test2.csv", "West Virginia", "County", "Crude.Rate")
state_map <- function(df_path, state, county_label, var_label) {
state <- tolower(state)
states <- map_data("state")
counties <- map_data("county")
state_df <- subset(states, region == state)
state_county_df <- subset(counties, region == state)
df <- read.csv(df_path)
df <- subset(df, select=c(county_label, var_label))
names(df) <- c("subregion", var_label)
df[,"subregion"] <- tolower(df[,"subregion"])
df[,var_label] <- as.numeric(as.character(df[,var_label]))
mapped_df <- inner_join(state_county_df, df, by="subregion")
plot <- ggplot(data = mapped_df, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(data=state_county_df, fill=NA, color="white")
geom_polygon(data=mapped_df, aes(fill=mapped_df[,var_label]), color="white")
return(plot)
}
state_map("test2.csv", "West Virginia", "County", "Crude.Rate")
state_map <- function(df_path, state, county_label, var_label) {
state <- tolower(state)
states <- map_data("state")
counties <- map_data("county")
state_df <- subset(states, region == state)
state_county_df <- subset(counties, region == state)
df <- read.csv(df_path)
df <- subset(df, select=c(county_label, var_label))
names(df) <- c("subregion", var_label)
df[,"subregion"] <- tolower(df[,"subregion"])
df[,var_label] <- as.numeric(as.character(df[,var_label]))
mapped_df <- inner_join(state_county_df, df, by="subregion")
plot <- ggplot(data = mapped_df, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(data=state_county_df, fill=NA, color="white") +
geom_polygon(data=mapped_df, aes(fill=mapped_df[,var_label]), color="white")
return(plot)
}
state_map("test2.csv", "West Virginia", "County", "Crude.Rate")
source('~/instamap/R/instamap.R')
document()
library(roxygen2)
document()
version(ggplot2)
packageVersion("ggplot2")
packageVersion("maps")
packageVersion("dplyr")
